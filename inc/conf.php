<?php
/**********************************************************************************
*		Script pour extraire les prochains passages avec le plus de détails possible
*		En attendant le retour de NanoRatp
*
*		ksar <ksar.ksar@gmail.com>
************************************************************************************/

/********** Définition des constantes *********/

//Verbose débug
define('DEBUG', false);

//API key
define('API_KEY','9N9w8i21Qccdui9I1Q7jmG5XCEJsj1SJ');

// connect to the database
$db = new mysqli('localhost', "rerb", "rerbetail1", "rerb");

//Verification of the connexion
if($db->connect_error){
	die(date("Y-m-d H:i:s").' Error database connection: ' .$db->connect_error);
}

//Tableau des arrets avec leur nom commercial et ArID
$arrets = array (
	1 => array(	0 => "Aéroport CDG 2 TGV",
				1 => 473364,
				2 => "",
				3 => "",
				4 => "1,2,3,4,5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "1,2,3,4,5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	2 => array(	0 => "Aéroport CDG 1", 
				1 => 462398, 
				2 => "2,1",
				3 => "",
				4 => "2,3,4,5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "2,3,4,5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47",
				6 => "Aéroport Charles de Gaulle 1 (Terminal 3)"),
	3 => array(	0 => "Parc des Expositions",
				1 => 47878,
				2 => "3,2,1",
				3 => "",
				4 => "3,4,5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "3,4,5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	4 => array(	0 => "Villepinte",
				1 => 58793,
				2 => "4,3,2,1",
				3 => "",
				4 => "4,5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "4,5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	5 => array(	0 => "Sevran-Beaudottes",
				1 => 43193,
				2 => "5,4,3,2,1",
				3 => "",
				4 => "5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	6 => array( 0 => "Mitry-Claye",
				1 => 43164,
				2 => "",
				3 => "",
				4 => "6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	7 => array( 0 => "Villeparisis-Mitry-le-Neuf",
				1 => 46725,
				2 => "7,6",
				3 => "",
				4 => "7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47",
				6 => "Villeparisis - Mitry-Le-Neuf"),
	8 => array( 0 => "Vert-Galant", 
				1 => 46222,
				2 => "8,7,6",
				3 => "",
				4 => "8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	9 => array(	0 => "Sevran-Livry", 
				1 => 43194,
				2 => "9,8,7,6",
				3 => "",
				4 => "9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	10 => array(0 => "Aulnay-Sous-Bois",
				1 => 43071,
				2 => "10,5,4,3,2,1",
				3 => "10,9,8,7,6",
				4 => "10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	11 => array(0 => "Le Blanc-Mesnil",
				1 => 46163,
				2 => "11,10,5,4,3,2,1",
				3 => "11,10,9,8,7,6",
				4 => "11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	12 => array(0 => "Drancy",
				1 => 43122,
				2 => "12,11,10,5,4,3,2,1",
				3 => "12,11,10,9,8,7,6",
				4 => "12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	13 => array(0 => "Le Bourget", 
				1 => 43231,
				2 => "13,12,11,10,5,4,3,2,1",
				3 => "13,12,11,10,9,8,7,6",
				4 => "13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47",
				6 => "Gare du Bourget"),
	14 => array(0 => "La Courneuve-Aubervilliers", 
				1 => 43140,
				2 => "14,13,12,11,10,5,4,3,2,1",
				3 => "14,13,12,11,10,9,8,7,6",
				4 => "14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "14,15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	15 => array(0 => "La Plaine-Stade de France", 
				1 => 43145,
				2 => "15,14,13,12,11,10,5,4,3,2,1",
				3 => "15,14,13,12,11,10,9,8,7,6",
				4 => "15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "15,16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47",
				6 => "La Plaine - Stade de France",
				7 => "Gare de La Plaine - Stade de France"),
	16 => array(0 => "Gare du Nord", 
				1 => 462394,
				2 => "16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "16,15,14,13,12,11,10,9,8,7,6",
				4 => "16,17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "16,17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	17 => array(0 => "Châtelet-Les Halles", 
				1 => 45102,
				2 => "17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "17,18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "17,18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47",
				6 => "Châtelet Les Halles"),
	18 => array(0 => "Saint-Michel", 
				1 => 44877,
				2 => "18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "18,19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "18,19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	19 => array(0 => "Luxembourg", 
				1 => 43833,
				2 => "19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "19,20,21,22,23,24,25,26,27,28,29,30",
				5 => "19,20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	20 => array(0 => "Port Royal", 
				1 => 44500,
				2 => "20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "20,21,22,23,24,25,26,27,28,29,30",
				5 => "20,21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	21 => array(0 => "Denfert-Rochereau", 
				1 => 473890,
				2 => "21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "21,22,23,24,25,26,27,28,29,30",
				5 => "21,22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47",
				6 => "Denfert Rochereau"),
	22 => array(0 => "Cité Universitaire", 
				1 => 473843,
				2 => "22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "22,23,24,25,26,27,28,29,30",
				5 => "22,23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	23 => array(0 => "Gentilly", 
				1 => 45877,
				2 => "23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "23,24,25,26,27,28,29,30",
				5 => "23,24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	24 => array(0 => "Laplace", 
				1 => 43607,
				2 => "24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "24,25,26,27,28,29,30",
				5 => "24,25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	25 => array(0 => "Arcueil-Cachan", 
				1 => 43067,
				2 => "25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "25,26,27,28,29,30",
				5 => "25,26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	26 => array(0 => "Bagneux", 
				1 => 44493,
				2 => "26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "26,27,28,29,30",
				5 => "26,27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	27 => array(0 => "Bourg-la-Reine", 
				1 => 43097,
				2 => "27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "27,28,29,30",
				5 => "27,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47",
				6 => "Bourg-La-Reine"),
	28 => array(0 => "Sceaux", 
				1 => 59206,
				2 => "28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "28,29,30",
				5 => ""),
	29 => array(0 => "Fontenay-aux-Roses", 
				1 => 43125,
				2 => "29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "29,30",
				5 => ""),
	30 => array(0 => "Robinson", 
				1 => 43186,
				2 => "30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => ""),
	31 => array(0 => "Parc de Sceaux", 
				1 => 43177,
				2 => "31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	32 => array(0 => "La Croix-de-Berny-Fresnes", 
				1 => 46007,
				2 => "32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	33 => array(0 => "Antony", 
				1 => 43066,
				2 => "33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "33,34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	34 => array(0 => "Fontaine-Michalon", 
				1 => 43124,
				2 => "34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "34,35,36,37,38,39,40,41,42,43,44,45,46,47"),
	35 => array(0 => "Les Baconnets", 
				1 => 43228,
				2 => "35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "35,36,37,38,39,40,41,42,43,44,45,46,47"),
	36 => array(0 => "Massy-Verrières", 
				1 => 47940,
				2 => "36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "36,37,38,39,40,41,42,43,44,45,46,47"),
	37 => array(0 => "Massy-Palaiseau", 
				1 => 58774,
				2 => "37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "37,38,39,40,41,42,43,44,45,46,47"),
	38 => array(0 => "Palaiseau", 
				1 => 47009,
				2 => "38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "38,39,40,41,42,43,44,45,46,47"),
	39 => array(0 => "Palaiseau-Villebon", 
				1 => 43175,
				2 => "39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "39,40,41,42,43,44,45,46,47"),
	40 => array(0 => "Lozère", 
				1 => 474069,
				2 => "40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "40,41,42,43,44,45,46,47"),
	41 => array(0 => "Le Guichet", 
				1 => 43232,
				2 => "41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "41,42,43,44,45,46,47"),
	42 => array(0 => "Orsay-Ville", 
				1 => 43086,
				2 => "42,41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "42,41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "42,43,44,45,46,47"),
	43 => array(0 => "Bures-sur-Yvette", 
				1 => 43103,
				2 => "43,42,41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "43,42,41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "43,44,45,46,47"),
	44 => array(0 => "La Hacquinière", 
				1 => 47046,
				2 => "44,43,42,41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "44,43,42,41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "44,45,46,47"),
	45 => array(0 => "Gif-sur-Yvette", 
				1 => 47888,
				2 => "45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "45,46,47"),
	46 => array(0 => "Courcelle-sur-Yvette", 
				1 => 47052,
				2 => "46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "46,47"),
	47 => array(0 => "Saint-Rémy-Lès-Chevreuse", 
				1 => 47889,
				2 => "47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,5,4,3,2,1",
				3 => "47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6",
				4 => "",
				5 => "")
);

//Tableau des voies pour la zone RATP. Vu que la RATP ne remote pas le quai dans l'outil....
//En fontion du StoP point, donne le quai
$quais = array (
	// Saint remy
	474012 => "Voie 1",
	474011 => "Voie 2",
	474009 => "Voie 3",
	// Orsay Ville
	473901 => "Voie 2",
	473903 => "Voie 1",
	473904 => "Voie Z",
	// Massy Palaiseau
	474056 => "Voie 2",
	474058 => "Voie A",
	474060 => "Voie 1",
	474061 => "Voie B",
	// Robinson
	474024 => "Voie 1B",
	474025 => "Voie 4",
	474026 => "Voie 2B",
	// Bourg-la-Reine
	473969 => "Voie 1",
	473970 => "Voie 2",
	473971 => "Voie 1B",
	473972 => "Voie 2B",
	// Laplace
	473926 => "Voie Z",
	473927 => "Voie 2",
	473932 => "Voie 1",
	// Denfert-Rochereau
	473994 => "Voie 1",
	473997 => "Voie 2",
	480170 => "Voie 3"
	);